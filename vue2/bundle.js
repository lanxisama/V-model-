(()=>{"use strict";class t{constructor(){this.listenerList=[]}listen(t){this.listenerList.push(t)}notify(){for(let t=0;t<this.listenerList.length;t++)this.listenerList[t].update()}}t.prototype.target=null;const e=t,s=/\{\{(.*)\}\}/,i=new class{constructor(t){this.$options=t,this.$el=this.$options.el,this._data=this.$options.data,Object.keys(this._data).forEach((t=>{this._provy(t)})),new class{constructor(t){this.data=t,Object.keys(this.data).forEach((e=>{this._bind(t,e,t[e])}))}_bind(t,s,i){var a=new e;Object.defineProperty(t,s,{get:()=>(e.target&&a.listen(e.target),console.log(e.target),i),set(t){t!==i&&(i=t,a.notify())}})}}(this._data),new class{constructor(t,e){this.el=document.querySelector(t),this.vm=e,this.frag=this._createFragment(),this.el.appendChild(this.frag)}_createFragment(){for(var t,e=document.createDocumentFragment();t=this.el.firstChild;)this._complie(t),e.appendChild(t);return e}_complie(t){if(1===t.nodeType){var i=t.attributes,a=this;if(i.hasOwnProperty("v-model")){var o=i["v-model"].nodeValue;t.addEventListener("input",(function(t){console.log("input"),a.vm[o]=t.target.value})),t.value=this.vm[o]}}3===t.nodeType&&(console.log("文本节点",t.nodeValue),s.test(t.nodeValue)&&(o=(o=RegExp.$1).trim(),console.log(o,t.nodeValue),new class{constructor(t,s,i){this.node=t,this.name=s,this.vm=i,e.target=this,this.update(),e.target=null}update(){this.node.nodeValue=this.vm[this.name]}}(t,o,this.vm)))}}(this.$el,this)}_provy(t){var e=this;Object.defineProperty(this,t,{get:()=>e._data[t],set(s){e._data[t]=s}})}}({el:"#app",data:{message:"双向绑定"}});console.log("vm",i)})();